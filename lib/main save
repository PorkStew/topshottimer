import 'dart:convert';

import 'package:flutter/material.dart';
//import 'package:topshottimer/random.dart';
import 'package:crypto/crypto.dart';
import 'package:topshottimer/signup.dart' as signup;
import 'package:http/http.dart' as http;
void main() {
  runApp(MyApp());
}

class MyApp extends StatelessWidget {
  // This widget is the root of your application.
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: MyHomePage() ,
    );
  }
}

class MyHomePage extends StatelessWidget{
  @override
  Widget build(BuildContext context){
    return Scaffold(
        appBar: AppBar(title: Text('Hello World!')),
        body: TextInputWidget());
  }
}

class TextInputWidget extends StatefulWidget {
  @override
  _TextInputWidgetState createState() => _TextInputWidgetState();
}

class _TextInputWidgetState extends State<TextInputWidget> {
  //variable declarations
  final email = TextEditingController();
  final password = TextEditingController();
  @override
  Widget build(BuildContext context) {
    return Column(children: [
      Container(
        padding: EdgeInsets.only(top: 20),
        child:
      TextField(
        controller: this.email,
        decoration: InputDecoration(
            prefixIcon: Icon(Icons.email), labelText: "Email here"),
        ),
      ),
      TextField(
        controller: this.password,
        decoration: InputDecoration(
            prefixIcon: Icon(Icons.lock), labelText: "Password here"),
      ),
    Container(
      padding: EdgeInsets.only(top: 20),
      child:
      FlatButton(
        color: Colors.blue,
        minWidth: 200.0,
        onPressed: () {
        updateData();
      }, child: Text("LOGIN"),),
    ),
      FlatButton(
        color: Colors.green,
        minWidth: 200.0,
        onPressed: () {
        Navigator.push(context, MaterialPageRoute(builder: (context) => signup.MyStatefulWidget()));
      }, child: Text("SIGN UP"),),
    ],);
  }

  Future updateData() async{
    String hashedPassword = "";
    var bytes = utf8.encode(password.text);
    var digest = sha256.convert(bytes);
    hashedPassword = digest.toString();
    var url = 'https://nutant-ratings.000webhostapp.com/read.php';
    var res = await http.post(Uri.encodeFull(url), headers: {"Accept":"application/jason"},
        body: {
          "emailAddress": email.text,
          "password": hashedPassword,
        }
    );
    print(res.body);
  }

  Future getData() async{
    var url = 'https://nutant-ratings.000webhostapp.com/read.php';
    http.Response response = await http.get(url);
    if(response.body.isNotEmpty) {
      var data = json.decode(response.body);
      print(data);
    }else{
      print("failed");
    }
  }

}

